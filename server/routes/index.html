<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    const permissionsAll = [
      {
        "_id": "5fe05f394dc1a53a0436aa9f",
        "parentName": "0",
        "type": 0,
        "name": "健康管理",
        "path": "/health",
        "icon": "plus",
        "component": "Health",
      },
      {
        "_id": "5fe05f394dc1a53a0436aaa0",
        "parentName": "健康管理",
        "type": 0,
        "name": "每日食谱",
        "path": "/health/food",
        "icon": "plus",
        "component": "Food",
      },
      {
        "_id": "5fe05f394dc1a53a0436aa9a",
        "parentName": "权限管理",
        "type": 0,
        "name": "用户管理",
        "path": "/permission/user",
        "icon": "plus",
        "component": "User",
      },
      {
        "_id": "5fe05f394dc1a53a0436aa9b",
        "parentName": "权限管理",
        "type": 0,
        "name": "角色管理",
        "path": "/permission/role",
        "icon": "plus",
        "component": "Role",
      },
      {
        "_id": "5fe05f394dc1a53a0436aa9c",
        "parentName": "权限管理",
        "type": 0,
        "name": "菜单管理",
        "path": "/permission/menu",
        "icon": "plus",
        "component": "Menu",
      },
      {
        "_id": "5fe05f394dc1a53a0436aa9d",
        "parentName": "0",
        "type": 0,
        "name": "权限管理",
        "path": "/permission",
        "icon": "plus",
        "component": "Permission",
      },
      {
        "name": "角色管理儿子",
        "path": "/permission/role",
        "icon": "plus",
        "parentName": "角色管理",
        "type": 0,
        "component": "Role"
      },
      {
        "_id": "5fe05f394dc1a53a0436aa9e",
        "parentName": "0",
        "type": 0,
        "name": "安全管理",
        "path": "/security",
        "icon": "plus",
        "component": "Security",
      }
    ]
    // 生成树形结构
    const permissions = [
      {
        parentName: '0',
        type: 0,
        _id: "5fe05f394dc1a53a0436aa9d",
        name: '权限管理',
        path: '/permission',
        icon: 'plus',
        component: 'Permission',
        __v: 0
      },
      {
        parentName: '0',
        type: 0,
        _id: "5fe05f394dc1a53a0436aa9f",
        name: '健康管理',
        path: '/health',
        icon: 'plus',
        component: 'Health',
        __v: 0
      },
      {
        "name": "角色管理",
        "path": "/permission/role",
        "icon": "plus",
        "parentName": "权限管理",
        "type": 0,
        "component": "Role"
      },
      {
        "name": "角色管理儿子",
        "path": "/permission/role",
        "icon": "plus",
        "parentName": "角色管理",
        "type": 0,
        "component": "Role"
      },
      {
        "name": "菜单管理",
        "path": "/permission/menu",
        "icon": "plus",
        "parentName": "权限管理",
        "type": 0,
        "component": "Menu"
      },
    ]
    function filterPermissionsRenderTree(permissionsAll) {
      return permissionsAll.reduce((p, c) => {
        if (c.parentName === '0') {
          p.push(c)
        } else {
          const parentMenu = permissionsAll.find(permission => permission.name === c.parentName)
          if (parentMenu) {
            parentMenu.children = parentMenu.children ? [...parentMenu.children, c] : [c]
          }
        }
        return p
      }, [])
    }
    // 树形结构菜单
    const treeListData = filterPermissionsRenderTree(JSON.parse(JSON.stringify(permissionsAll)))
    // 过滤多余菜单
    function filterTreeListData(treeListData) {
      // console.log(treeListData, '原数组')
      // console.log(permissions, '要保留的菜单')
      for (let i = 0; i < treeListData.length; i++) {
        const item = treeListData[i]
        if (item.children) {
          filterTreeListData(item.children)
        }
        if (item.name === permissions[0].name) {
          treeListData.splice(i, 1)
          i--
        }
      }
      return treeListData
    }
    const res = filterTreeListData(JSON.parse(JSON.stringify(treeListData)), permissions)
    console.log(res)
  </script>
</body>

</html>